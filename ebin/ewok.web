% ewok.conf
% all time values are in seconds
% all size values are in bytes
{ewok_server, ewok, [
	{runmode, development},
	
	{server, [
		{ip, any},
		{hostname, "localhost"} %% unused
	]},
		
	{identity, [
		{keystore, "./priv/data/.keystore"}
	]},
	
	{tasks, []}, % no conf as yet
	
	{datasources, [ 
		{default, mnesia}, % no other option offered for now (and maybe never)
		{mnesia, [
			{mod, {ewok_mnesia_ds, []}}, %%
			{path, "./priv/data"}
		]},
		{riak, [{mod, riak_ds, []}]},
		{couchdb, [{mod, couchdb_ds, []}]},
		{postgresql, [{mod, ewok_postgresql_ds, []}]},
		{mysql, [{mod, mysql_ds, []}]},
		{aws_sdb, [ 
			{mod, aws_sdb_ds, []},
			%% NOTE: sample keys from Amazon - move to .keystore later
			{sdb_access_key, "022QF06E7MXBSH9DHM02"}, 
			{sdb_secret_key, "kWcrlUX5JEDGM/LtmEENI/aVmYvHNif5zB+d9+ct"}
		]}
		%% NOTE: consider other EIS tier datasource types 
		%% -- can ALL datasources be abstracted to KV stores?
	]},
	
	{queues, [
		{default, rabbitmq}, % no other option offered for now (and maybe never)
		{rabbitmq, [ %% 
			{data_path, "./priv/data"},
			{url, "amqp://localhost"},
			{port, 5432},
			{user, "admin"},
			{password, "password"}
		]}
	]},
	
	{http, [
		{port, 8000},
		
		{tcp, [ 
		%% no need to touch these unless you know *exactly* what you are doing
			{max_connections, 2048},
			{backlog, 30},
			{socket, [
				{mode, binary},
				{reuseaddr, true},
				{packet, 0}, % don't think this is exactly the same as 'raw'
				{active, false},
				{recbuf, 8192},
				{nodelay, true}
			]}
		]},
		
		{ssl, [
			{enabled, false},
			{verify, 0}, %% for now, direct representation of SSL opts
			{depth, 1}, %% for now, direct representation of SSL opts
			{password, undefined}, %% you should ONLY set this if key.pem is pw protected
			{keyfile, "./priv/ssl/key.pem"},
			{certfile, "./priv/ssl/cert.pem"},
			{cacertfile, "./priv/ssl/cacerts.pem"}
		]},
		
		{header_limit, 100}, %% 'infinity' turns off...
		{request_timeout, 30},
		
		{deploy_root, "./priv/apps"},
		{autodeploy, [ewok_admin]},
		
		%% Cache is used in production mode to cache static files
		%% and their file information for response headers --
		%% the idea is to reduce file handles used by the system
		%% and potentially massively speed up static file serving
		%% "RAM is the new Disk" -- however you are well advised to
		%% shove all non-sensitive file resources into your downstream
		%% http server where possible and let that server do the work.
		{cache, [
			{max_file_size, 102400} % up to 100k - depends on your RAM
		]},
		
		{session, [
			{timeout, 1800}, %% http sessions timeout after 30 minutes
			{flush_interval, 120}, %% flush sessions every 2 minutes when idle
			{force_flush, 3600} %% force a cleanup of stale sessions every hour
		]},
	
		%% maybe move to a seperate def file... or as a separate term
		{mimetype, default, "application/x-octet-stream"},
		{mimetype, ".bmp", "image/bmp"},
		{mimetype, ".bz2", "application/x-bzip2"},
		{mimetype, ".css", "text/css"},
		{mimetype, ".csv", "text/csv"},
		{mimetype, ".doc", "application/msword"},
		{mimetype, ".esp", "application/xhtml+xml"},
		{mimetype, ".exe", "application/octet-stream"},
		{mimetype, ".gif", "image/gif"},
		{mimetype, ".gz", "application/x-gzip"},
		{mimetype, ".html", "text/html"},
		{mimetype, ".ico", "image/x-icon"},
		{mimetype, ".jpg", "image/jpeg"},
		{mimetype, ".js", "application/x-javascript"},
		{mimetype, ".json", "application/json"},
		{mimetype, ".m3u", "audio/x-mpegurl"},
		{mimetype, ".m4a", "audio/mpeg"},
		{mimetype, ".mov", "video/quicktime"},
		{mimetype, ".mp3", "audio/mpeg"},
		{mimetype, ".pdf", "application/pdf"},
		{mimetype, ".png", "image/png"},
		{mimetype, ".rtf", "application/rtf"},
		{mimetype, ".swf", "application/x-shockwave-flash"},
		{mimetype, ".tar", "application/x-tar"},
		{mimetype, ".tgz", "application/x-gzip"},
		{mimetype, ".txt", "text/plain"},
		{mimetype, ".ubf", "application/x-ubf"},
		{mimetype, ".xhtml", "application/xhtml+xml"},
		{mimetype, ".xls", "application/vnd.ms-excel"},
		{mimetype, ".xml", "application/xml"},		
		{mimetype, ".wav", "audio/x-wav"},
		{mimetype, ".z", "application/x-compress"},
		{mimetype, ".zip", "application/zip"}
	]},
	%% TODO: if this is moved to http, log then there's a dependency
	%% to be accounted for in create_log in ewok_logging_srv
	{log, [
		{level, info},
		{path, "./priv/log"},
		{access, [
			{enable, true},
			{rollover, infinity},
			{maxfiles, infinity}
		]},
		{auth, [
			{enable, true},
			{rollover, infinity},
			{maxfiles, infinity}
		]},
		{server, [ %
			{enable, true},
			{rollover, infinity},
			{maxfiles, infinity}		
		]}
	]}
]}.

%% this will probably disappear when web_admin is finished...
%% ...or perhaps be used *only* for installation.
{web_application, ewok, [
	{http, [
		{app_path, "/"}, % is this ever necessary ???
		
		%% realm-based role... this probably shouldn't be in here at all
		{login, "/login"}, 
		
		{www_root, "./priv/www"},
		{template_root, "./priv/esp"},
		{index_file, "index.html"},
		
		{roles, []},
		
		{route, default, ewok_file_handler, ewok, any},
		{route, "/", ewok_home, ewok, any},
		{route, "/home", ewok_home, ewok, any},
		{route, "/ajax", ewok_print_handler, ewok, any},
		{route, "/login", ewok_login_handler, ewok, any},
		{route, "/activation", ewok_activation_handler, ewok, any}
	]}	
]}.
